# Udacity Cloud DevOps Engineer Nanodegree - Capstone Project

## Jenkins

Jenkins setup on EC2 is partially automated via a CloudFormation script, to be launched with `make jenkins-create`
(**Note:** a file named `jenkins-setup-params.json` must be filled with the required information). Although, the
installation procedure must be completed through the GUI. Login to Jenkins interface, using the URL outputted by the
CloudFormation script, and install the following plugins:

- Blue Ocean (version `1.23`, available [here](https://updates.jenkins.io/download/plugins/blueocean/))
- GitHub API (version `1.115`, available [here](http://updates.jenkins-ci.org/download/plugins/github-api/))
- Pipeline: AWS Steps

The following plugins should be automatically installed together with the previous ones:

- Blue Ocean Pipeline Editor
- Blue Ocean Executor Info
- Config API for Blue Ocean
- Display URL for Blue Ocean
- Events API for Blue Ocean
- Git Pipeline for Blue Ocean
- GitHub Pipeline for Blue Ocean (version `1.23`, available [here](https://updates.jenkins.io/download/plugins/blueocean-github-pipeline/))
- Pipeline Implementation for Blue Ocean

After Jenkins has restarted, navigate to `/credentials/store/system/domain/_/` and add the following credentials:

- AWS access key and secret access key (automatically generated by the CloudFormation script)
- Docker Hub username and password

If you experience `HTTP 403` errors very often, consider navigating to `/configureSecurity/` and check "Enable proxy
compatibility", under "CSRF Protection" section (**WARNING:** this setting may increase Jenkins server vulnerability).

## AWS EKS

If the EKS cluster is not created from the EC2 instance used to deploy the Jenkins server (or, in any case, with user
credentials different from the `jenkins` user's ones), an additional procedure must be performed (described in
details [here](https://aws.amazon.com/premiumsupport/knowledge-center/eks-api-server-unauthorized-error/)):

1. With `jenkins` user credentials, run `aws sts get-caller-identity` to fetch the user ARN.
2. With the credentials used to create the EKS cluster, run `kubectl edit configmap aws-auth -n kube-system` and add the
   following lines to the ConfigMap:

   ```bash
   mapUsers: |
     - userarn: <jenkins user ARN>
       username: jenkins
       groups:
         - system:masters
   ```

3. With `jenkins` user credentials, run

   ```bash
   aws eks --region us-east-2 update-kubeconfig --name cloud-devops-capstone-cluster
   ```

   or, equivalently, `make kubectl-config` (that should be also automatically run by the Jenkins pipeline).
